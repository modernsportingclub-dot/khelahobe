<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡¶ï‡ßç‡¶∞‡ßÄ‡¶°‡¶º‡¶æ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶Ø‡ßã‡¶ó‡¶ø‡¶§‡¶æ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</title>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-color: #00695c;
            --secondary-color: #004d40;
            --accent-color: #ff8f00;
            --bg-color: #eceff1;
            --text-color: #263238;
            --white: #ffffff;
        }
        
        * { box-sizing: border-box; }

        body { 
            font-family: 'Hind Siliguri', sans-serif; 
            background-color: var(--bg-color); 
            margin: 0; padding: 5px; 
            color: var(--text-color); 
        }

        .container { 
            max-width: 100%; margin: 0 auto; 
            background: var(--white); 
            border-radius: 8px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
            min-height: 95vh; 
            padding-bottom: 60px; 
        }
        
        /* Tabs */
        .tabs { 
            display: flex; background: #b2dfdb; position: sticky; top: 0; z-index: 10;
            overflow-x: auto; white-space: nowrap; border-bottom: 2px solid var(--primary-color);
        }
        .tab-btn { 
            flex: 1; min-width: 90px; padding: 12px 5px; border: none; background: transparent; 
            font-size: 14px; font-weight: 600; font-family: 'Hind Siliguri', sans-serif; color: #444; 
        }
        .tab-btn.active { background: var(--primary-color); color: var(--white); }

        .tab-content { display: none; padding: 10px; }
        .tab-content.active { display: block; }

        /* Forms & Inputs */
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: 500; font-size: 15px; }
        input, select { 
            width: 100%; padding: 10px; border: 1px solid #cfd8dc; 
            border-radius: 6px; font-family: 'Hind Siliguri', sans-serif; font-size: 16px; 
        }
        .btn-submit { 
            width: 100%; padding: 12px; background: var(--primary-color); color: white; 
            border: none; border-radius: 6px; font-size: 18px; font-weight: 600; margin-top: 10px; 
        }

        /* Tables & Lists */
        .table-responsive { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 5px; }
        th, td { border-bottom: 1px solid #eee; padding: 10px 5px; text-align: left; vertical-align: middle; }
        th { background-color: var(--primary-color); color: white; font-size: 14px; }
        td { font-size: 15px; }
        
        /* Action Buttons */
        .btn-sm { padding: 5px 10px; border: none; border-radius: 4px; color: white; cursor: pointer; font-size: 13px; margin-right: 3px; }
        .btn-out { background: #d32f2f; }
        .btn-undo { background: #607d8b; }
        .btn-replay { background: #ff5722; color: white; } 
        .btn-edit { background: #ff9800; color: white; } 
        .btn-1st { background: #ffd700; color: black; }
        .btn-2nd { background: #c0c0c0; color: black; }
        .btn-3rd { background: #cd7f32; color: white; }
        /* Settings Player Management Styles */
.player-list-section { margin-bottom: 30px; border-bottom: 2px dashed #ccc; padding-bottom: 20px; }
.player-row { 
    display: flex; justify-content: space-between; align-items: center; 
    padding: 8px; border-bottom: 1px solid #eee; background: #fff; 
    border-radius: 4px; margin-bottom: 5px;
}
.player-name { font-size: 16px; font-weight: 500; }
.btn-del { background: #d32f2f; color: white; }
.btn-edit-name { background: #1976d2; color: white; }
        /* Search */
        .search-box { position: relative; margin-bottom: 10px; }
        .search-box input { padding-left: 30px; }
        .search-icon { position: absolute; left: 8px; top: 10px; color: #888; }
/* ‡¶è‡¶á ‡¶Ö‡¶Ç‡¶∂‡¶ü‡¶ø <style> ‡¶è‡¶∞ ‡¶≠‡ßá‡¶§‡¶∞‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶® */
.player-name { 
    font-size: 16px; 
    font-weight: 500; 
    cursor: pointer; /* ‡¶Æ‡¶æ‡¶â‡¶∏ ‡¶Ü‡¶á‡¶ï‡¶® ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶π‡¶¨‡ßá */
    color: var(--primary-color);
    text-decoration: underline; /* ‡¶®‡¶ø‡¶ö‡ßá ‡¶¶‡¶æ‡¶ó ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá */
}
.player-name:hover {
    color: var(--accent-color);
}
        /* Timer Modal */
        #timerModal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 2000; display: none; 
            flex-direction: column; justify-content: center; align-items: center; color: white;
        }
        .timer-display { 
            /* clamp(‡¶Æ‡¶ø‡¶®‡¶ø‡¶Æ‡¶æ‡¶Æ ‡¶∏‡¶æ‡¶á‡¶ú, ‡¶∞‡ßá‡¶∏‡¶™‡¶®‡ßç‡¶∏‡¶ø‡¶≠ ‡¶∏‡¶æ‡¶á‡¶ú, ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡¶ø‡¶Æ‡¶æ‡¶Æ ‡¶∏‡¶æ‡¶á‡¶ú) */
            font-size: clamp(30px, 11vw, 55px); 
            font-weight: bold; 
            font-family: monospace; 
            color: #00e676; 
            margin: 15px 0; 
            text-shadow: 0 0 10px rgba(0,230,118,0.5);
            
            /* ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶Ö‡¶Ç‡¶∂‡¶ó‡ßÅ‡¶≤‡ßã ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶Æ‡¶æ‡¶ù‡¶ñ‡¶æ‡¶®‡ßá ‡¶ì ‡¶è‡¶ï ‡¶≤‡¶æ‡¶á‡¶®‡ßá ‡¶∞‡¶æ‡¶ñ‡¶æ ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡¶¨‡ßá */
            width: 100%;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
        }
        /* Login Modal */
        #loginModal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 9999; display: flex; 
            justify-content: center; align-items: center;
        }

        .loader { display: none; text-align: center; color: var(--primary-color); }
        
        /* Grid */
        .games-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .game-checkbox { background: #fff; padding: 8px; border: 1px solid #ddd; border-radius: 4px; display: flex; align-items: center; font-size: 14px; }
        
        /* Control Panel inside Timer */
        .control-panel { width: 90%; text-align: center; }
        .input-score-box { background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; margin-top: 20px; }
    </style>
</head>
<body>

<!-- Login -->
<div id="loginModal">
    <div style="background:white; padding:30px; border-radius:10px; width:85%; max-width:300px; text-align:center;">
        <h2 style="color:var(--primary-color);">‡¶≤‡¶ó‡¶ø‡¶®</h2>
        <input type="number" id="loginPin" placeholder="PIN" style="text-align:center; font-size:24px; letter-spacing:5px;" inputmode="numeric">
        <button class="btn-submit" onclick="checkLogin()">‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂</button>
        <p style="font-size:12px; margin-top:10px; color:#666;">xxxx (Admin) | 1234 (Staff)</p>
    </div>
</div>
<div id="editModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:3000; justify-content:center; align-items:center;">
    <div style="background:white; padding:20px; border-radius:8px; width:90%; max-width:400px;">
        <h3 style="margin-top:0; color:var(--primary-color);">‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶Ç‡¶∂‡ßã‡¶ß‡¶®</h3>
        
        <label>‡¶®‡¶æ‡¶Æ:</label>
        <input type="text" id="editNameInput" style="margin-bottom:15px;">
        
        <label>‡¶ñ‡ßá‡¶≤‡¶æ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®:</label>
        <div class="games-grid" id="editGamesContainer">
            </div>

        <div style="margin-top:20px; text-align:right;">
            <button onclick="document.getElementById('editModal').style.display='none'" style="padding:8px 15px; background:#f44336; color:white; border:none; border-radius:4px; cursor:pointer;">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
            <button onclick="saveEditData()" style="padding:8px 15px; background:#4caf50; color:white; border:none; border-radius:4px; cursor:pointer;">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>
</div>
<!-- Timer Modal -->
<div id="timerModal">
    <button style="position:absolute; top:20px; right:20px; background:none; border:none; color:white; font-size:30px;" onclick="closeTimer()">‚úï</button>
    <h2 id="timerPlayerName" style="color:#ddd; margin-bottom:5px;">Player</h2>
    <div style="font-size:14px; color:#aaa;" id="timerGameLabel">Game Name</div>
    
    <div class="timer-display" id="timerDisplay">00:00:00.00</div>
    
    <!-- Controls when Timer is RUNNING or STOPPED -->
    <div class="timer-controls" id="mainControls">
        <button onclick="startTimer()" id="btnStart" style="background:#00e676; color:#000;">‡¶∂‡ßÅ‡¶∞‡ßÅ</button>
        <button onclick="pauseTimer()" id="btnPause" style="background:#ffeb3b; color:#000; display:none;">‡¶•‡¶æ‡¶Æ‡ßÅ‡¶®</button>
    </div>

    <!-- Controls when Timer is PAUSED (Resume / Reset / Save) -->
    <div class="control-panel" id="pausedControls" style="display:none;">
        <p style="color:#ffeb3b; font-weight:bold;">‡¶ñ‡ßá‡¶≤‡¶æ ‡¶∏‡ßç‡¶•‡¶ó‡¶ø‡¶§ ‡¶Ü‡¶õ‡ßá</p>
        <div class="timer-controls" style="justify-content:center;">
            <button onclick="resumeTimer()" style="background:#00e676; color:black;">‡¶ö‡¶æ‡¶≤‡¶ø‡ßü‡ßá ‡¶Ø‡¶æ‡¶®</button>
            <button onclick="resetTimer()" style="background:#f44336; color:white;">‡¶∞‡¶ø‡¶∏‡ßá‡¶ü</button>
        </div>
        
        <!-- Score Input Section -->
        <div class="input-score-box">
            <div id="waterInputDiv" style="display:none; margin-bottom:10px;">
                <label style="color:#4fc3f7;">‡¶ú‡¶≤‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (ml)</label>
                <input type="number" id="waterAmount" placeholder="ml" style="text-align:center; font-size:20px; width:100px;">
            </div>
            
            <label id="scoreInputLabel" style="color:white; display:block; margin-bottom:5px;">‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®</label>
            <input type="text" id="finalScoreInput" style="text-align:center; font-size:24px; width:120px; padding:5px; border-radius:5px; border:none;">
            
            <button class="btn-submit" style="background:#29b6f6; color:black; margin-top:15px;" onclick="saveTimerData()">‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>
</div>
<audio id="notifSound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" preload="auto"></audio>
<div class="container">
    <div class="tabs">
        <button class="tab-btn active" id="tab-reg" onclick="switchTab('registration')">‡¶®‡¶æ‡¶Æ ‡¶®‡¶•‡¶ø‡¶≠‡ßÅ‡¶ï‡ßç‡¶§</button>
        <button class="tab-btn" id="tab-mgmt" onclick="switchTab('management')">‡¶ñ‡ßá‡¶≤‡¶æ ‡¶™‡¶∞‡¶ø‡¶ö‡¶æ‡¶≤‡¶®‡¶æ</button>
        <button class="tab-btn" id="tab-res" onclick="switchTab('results')">‡¶´‡¶≤‡¶æ‡¶´‡¶≤</button>
        <button class="tab-btn" id="tab-set" onclick="switchTab('settings')">‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç</button>
    </div>

    <!-- Registration -->
    <div id="registration" class="tab-content active">
        <div class="form-group"><input type="date" id="regDate"></div>
        <div class="form-group">
            <input type="text" id="nameInput" placeholder="‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® (English -> Bangla)" autocomplete="off">
            <div id="suggestions" style="border:1px solid #ddd; display:none; background:white;"></div>
        </div>
        <div class="games-grid">
            <label class="game-checkbox"><input type="checkbox" value="hari_bhanga"> ‡¶π‡¶æ‡¶°‡¶º‡¶ø‡¶≠‡¶æ‡¶ô‡ßç‡¶ó‡¶æ</label>
            <label class="game-checkbox"><input type="checkbox" value="shankha"> ‡¶∂‡¶ô‡ßç‡¶ñ‡¶¨‡¶æ‡¶ú‡¶æ‡¶®‡ßã</label>
            <label class="game-checkbox"><input type="checkbox" value="glass_circle"> ‡¶ó‡ßá‡¶≤‡¶æ‡¶∏ ‡¶∏‡¶æ‡¶∞‡ßç‡¶ï‡ßá‡¶≤</label>
            <label class="game-checkbox"><input type="checkbox" value="phuchka"> ‡¶´‡ßÅ‡¶ö‡¶ï‡¶æ ‡¶ñ‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ</label>
            <label class="game-checkbox"><input type="checkbox" value="sajo"> ‡¶Ø‡ßá‡¶Æ‡¶® ‡¶ñ‡ßÅ‡¶∂‡¶ø ‡¶∏‡¶æ‡¶Å‡¶ú‡ßã</label>
            <label class="game-checkbox"><input type="checkbox" value="musical_chair"> ‡¶Æ‡¶ø‡¶â‡¶ú‡¶ø‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤ ‡¶ö‡ßá‡¶Ø‡¶º‡¶æ‡¶∞</label>
            <label class="game-checkbox"><input type="checkbox" value="candle"> ‡¶Æ‡ßã‡¶Æ‡¶¨‡¶æ‡¶§‡¶ø ‡¶ú‡ßç‡¶¨‡¶æ‡¶≤‡¶æ‡¶®‡ßã</label>
        </div>
        <div id="regLoader" class="loader">‡¶∏‡ßá‡¶≠ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
        <button class="btn-submit" onclick="register()">‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</button>
    </div>

    <!-- Management -->
    <div id="management" class="tab-content">
        <select id="mgmtGameSelector" onchange="renderMgmt()">
            <option value="">-- ‡¶ñ‡ßá‡¶≤‡¶æ ‡¶¨‡¶æ‡¶õ‡ßÅ‡¶® --</option>
            <option value="hari_bhanga">‡¶π‡¶æ‡¶°‡¶º‡¶ø‡¶≠‡¶æ‡¶ô‡ßç‡¶ó‡¶æ</option>
            <option value="shankha">‡¶∂‡¶ô‡ßç‡¶ñ‡¶¨‡¶æ‡¶ú‡¶æ‡¶®‡ßã</option>
            <option value="glass_circle">‡¶ó‡ßá‡¶≤‡¶æ‡¶∏ ‡¶∏‡¶æ‡¶∞‡ßç‡¶ï‡ßá‡¶≤</option>
            <option value="phuchka">‡¶´‡ßÅ‡¶ö‡¶ï‡¶æ ‡¶ñ‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ</option>
            <option value="sajo">‡¶Ø‡ßá‡¶Æ‡¶® ‡¶ñ‡ßÅ‡¶∂‡¶ø ‡¶∏‡¶æ‡¶Å‡¶ú‡ßã</option>
            <option value="musical_chair">‡¶Æ‡¶ø‡¶â‡¶ú‡¶ø‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤ ‡¶ö‡ßá‡¶Ø‡¶º‡¶æ‡¶∞</option>
            <option value="candle">‡¶Æ‡ßã‡¶Æ‡¶¨‡¶æ‡¶§‡¶ø ‡¶ú‡ßç‡¶¨‡¶æ‡¶≤‡¶æ‡¶®‡ßã</option>
        </select>
        
        <div class="search-box" style="margin-top:10px;">
            <span class="search-icon">üîç</span>
            <input type="text" id="mgmtSearch" placeholder="‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." onkeyup="renderMgmt()">
        </div>

        <div id="mgmtArea"></div>
    </div>

    <!-- Results -->
    <div id="results" class="tab-content">
        <select id="resGameSelector" onchange="renderResults()">
            <option value="">-- ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® --</option>
            <option value="hari_bhanga">‡¶π‡¶æ‡¶°‡¶º‡¶ø‡¶≠‡¶æ‡¶ô‡ßç‡¶ó‡¶æ</option>
            <option value="shankha">‡¶∂‡¶ô‡ßç‡¶ñ‡¶¨‡¶æ‡¶ú‡¶æ‡¶®‡ßã</option>
            <option value="glass_circle">‡¶ó‡ßá‡¶≤‡¶æ‡¶∏ ‡¶∏‡¶æ‡¶∞‡ßç‡¶ï‡ßá‡¶≤</option>
            <option value="phuchka">‡¶´‡ßÅ‡¶ö‡¶ï‡¶æ ‡¶ñ‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ</option>
            <option value="sajo">‡¶Ø‡ßá‡¶Æ‡¶® ‡¶ñ‡ßÅ‡¶∂‡¶ø ‡¶∏‡¶æ‡¶Å‡¶ú‡ßã</option>
            <option value="musical_chair">‡¶Æ‡¶ø‡¶â‡¶ú‡¶ø‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤ ‡¶ö‡ßá‡¶Ø‡¶º‡¶æ‡¶∞</option>
            <option value="candle">‡¶Æ‡ßã‡¶Æ‡¶¨‡¶æ‡¶§‡¶ø ‡¶ú‡ßç‡¶¨‡¶æ‡¶≤‡¶æ‡¶®‡ßã</option>
        </select>
        <div id="resTitle" style="text-align:center; font-weight:bold; margin:10px 0; color:var(--primary-color);"></div>
        <table style="width:100%">
            <thead><tr><th>‡¶ï‡ßç‡¶∞‡¶Æ</th><th>‡¶®‡¶æ‡¶Æ</th><th>‡¶´‡¶≤‡¶æ‡¶´‡¶≤</th></tr></thead>
            <tbody id="resBody"></tbody>
        </table>
        <button onclick="window.print()" style="float:right; margin-top:10px; padding:5px; background:#607d8b; color:white; border:none;">Print</button>
    </div>

    <!-- Settings -->
  
<div id="settings" class="tab-content">
    
    <div class="player-list-section">
        <h3>‡¶ñ‡ßá‡¶≤‡ßã‡ßü‡¶æ‡ßú ‡¶∏‡¶Ç‡¶∂‡ßã‡¶ß‡¶® ‡¶ì ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</h3>
        <div class="search-box">
            <span class="search-icon">üîç</span>
            <input type="text" id="settingSearch" placeholder="‡¶®‡¶æ‡¶Æ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." onkeyup="renderPlayerList()">
        </div>
        <div id="playerMgmtList" style="max-height: 300px; overflow-y: auto;">
            </div>
    </div>
<div style="margin-top: 30px; border-top: 1px solid #ccc; padding-top: 15px;">
    
    <button class="btn-submit" style="background: #00897b; margin-bottom: 10px;" onclick="manualRefresh(this)">
        üîÑ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ (Background Sync)
    </button>

    <button class="btn-submit" style="background: #c62828;" onclick="doLogout()">
        üö™ ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü
    </button>
</div>
    <h3>‡¶ñ‡ßá‡¶≤‡¶æ‡¶∞ ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶®</h3>
    <p style="font-size:12px; color:gray;">‡¶ü‡¶æ‡¶á‡¶™ ‡¶¨‡¶¶‡¶≤‡¶æ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü ‡¶∏‡¶Æ‡ßü‡ßá‡¶∞ ‡¶ñ‡ßá‡¶≤‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
    <div id="settingsList"></div>
    <button class="btn-submit" onclick="saveConfig()">‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
</div>
</div>

<script>
    // ******************************************************
    // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ Web App URL ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¨‡¶∏‡¶æ‡¶®
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzmWCV-ntzI4_fdpSbr_ONtOrNSGoNj78peIDSmHsJpxwIHTW3kS8bVAqHTalLapq7Dlg/exec";
    // ******************************************************

    let participants = [];
    
    // Game Rules Configuration (Default)
  let gameConfig = {
    'hari_bhanga': { label: '‡¶π‡¶æ‡¶°‡¶º‡¶ø‡¶≠‡¶æ‡¶ô‡ßç‡¶ó‡¶æ', type: 'manual', unit: '‡¶∏‡ßá‡¶Æ‡¶ø', sort: 'low', status: 'active' },
    'shankha': { label: '‡¶∂‡¶ô‡ßç‡¶ñ‡¶¨‡¶æ‡¶ú‡¶æ‡¶®‡ßã', type: 'open', unit: '‡¶Æ‡¶ø‡¶≤‡¶ø ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°', sort: 'high', status: 'active' },
    'glass_circle': { label: '‡¶ó‡ßá‡¶≤‡¶æ‡¶∏ ‡¶∏‡¶æ‡¶∞‡ßç‡¶ï‡ßá‡¶≤', type: 'open', unit: '‡¶Æ‡¶ø‡¶≤‡¶ø ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°', sort: 'low', status: 'active' },
    'phuchka': { label: '‡¶´‡ßÅ‡¶ö‡¶ï‡¶æ ‡¶ñ‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ', type: 'fixed', duration: 60, unit: '‡¶ü‡¶ø', sort: 'high', status: 'active' },
    'candle': { label: '‡¶Æ‡ßã‡¶Æ‡¶¨‡¶æ‡¶§‡¶ø ‡¶ú‡ßç‡¶¨‡¶æ‡¶≤‡¶æ‡¶®‡ßã', type: 'manual', unit: '‡¶ü‡¶ø', sort: 'high', status: 'active' },
    'sajo': { label: '‡¶Ø‡ßá‡¶Æ‡¶® ‡¶ñ‡ßÅ‡¶∂‡¶ø ‡¶∏‡¶æ‡¶Å‡¶ú‡ßã', type: 'manual', unit: '‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü', sort: 'manual', status: 'active' },
    'musical_chair': { label: '‡¶Æ‡¶ø‡¶â‡¶ú‡¶ø‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤ ‡¶ö‡ßá‡¶Ø‡¶º‡¶æ‡¶∞', type: 'manual', unit: '', sort: 'manual', status: 'active' }
};

// LocalStorage ‡¶•‡ßá‡¶ï‡ßá ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶ï‡¶®‡¶´‡¶ø‡¶ó ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ
if(localStorage.getItem('gameConfig_v11')) {
    const saved = JSON.parse(localStorage.getItem('gameConfig_v11'));
    for(let k in saved) if(gameConfig[k]) Object.assign(gameConfig[k], saved[k]);
}
    // Load Config
    if(localStorage.getItem('gameConfig_v10')) {
        const saved = JSON.parse(localStorage.getItem('gameConfig_v10'));
        for(let k in saved) if(gameConfig[k]) Object.assign(gameConfig[k], saved[k]);
    }

    // --- Tab Switching Logic ---
  // --- Tab Switching Logic ---
function switchTab(tabId) {
    document.querySelectorAll('.tab-content').forEach(d => d.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    
    document.getElementById(tabId).classList.add('active');
    
    let btnId = '';
    if(tabId === 'registration') btnId = 'tab-reg';
    if(tabId === 'management') btnId = 'tab-mgmt';
    if(tabId === 'results') btnId = 'tab-res';
    if(tabId === 'settings') btnId = 'tab-set';
    
    if(btnId && document.getElementById(btnId)) {
        document.getElementById(btnId).classList.add('active');
    }

    if(tabId === 'management') renderMgmt();
    if(tabId === 'results') renderResults();
    if(tabId === 'settings') renderSettingsUI();
    renderPlayerList();

    // --- ‡¶è‡¶á ‡¶Ö‡¶Ç‡¶∂‡¶ü‡ßÅ‡¶ï‡ßÅ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶® (‡¶ñ‡ßá‡¶≤‡¶æ ‡¶¨‡¶®‡ßç‡¶ß ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶Ö‡¶´ ‡¶ï‡¶∞‡¶æ) ---
    if(tabId === 'registration') {
        document.querySelectorAll('.game-checkbox').forEach(label => {
            const checkbox = label.querySelector('input');
            const gameCode = checkbox.value;
            // ‡¶Ø‡¶¶‡¶ø ‡¶ñ‡ßá‡¶≤‡¶æ‡¶ü‡¶ø‡¶∞ status 'inactive' ‡¶•‡¶æ‡¶ï‡ßá
            if(gameConfig[gameCode] && gameConfig[gameCode].status === 'inactive') {
                label.style.opacity = '0.4'; // ‡¶ù‡¶æ‡¶™‡¶∏‡¶æ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
                label.style.pointerEvents = 'none'; // ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ
                checkbox.disabled = true; // ‡¶ö‡ßá‡¶ï‡¶¨‡¶æ‡¶ï‡ßç‡¶∏ ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨‡ßá ‡¶®‡¶æ
                // ‡¶®‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá (‡¶¨‡¶®‡ßç‡¶ß) ‡¶≤‡ßá‡¶ñ‡¶æ‡¶ü‡¶ø ‡¶ö‡¶æ‡¶á‡¶≤‡ßá ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®
                if(!label.innerText.includes('(‡¶¨‡¶®‡ßç‡¶ß)')) {
                    label.innerHTML += ' <small style="color:red;">(‡¶¨‡¶®‡ßç‡¶ß)</small>';
                }
            } else {
                // ‡¶ñ‡ßá‡¶≤‡¶æ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶∏‡ßç‡¶¨‡¶æ‡¶≠‡¶æ‡¶¨‡¶ø‡¶ï ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ
                label.style.opacity = '1';
                label.style.pointerEvents = 'auto';
                checkbox.disabled = false;
            }
        });
    }
}
    // --- Login & Init ---
    function checkLogin() {
        const pin = document.getElementById('loginPin').value;
        if(pin === '12349') { sessionStorage.setItem('role', 'admin'); initApp(); }
        else if(pin === '1234') { sessionStorage.setItem('role', 'staff'); initApp(); }
        else alert('‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶ø‡¶®!');
    }

    function initApp() {
        document.getElementById('loginModal').style.display = 'none';
        const role = sessionStorage.getItem('role');
        if(role === 'staff') {
            document.getElementById('tab-mgmt').style.display = 'none';
            document.getElementById('tab-set').style.display = 'none';
        }
        document.getElementById('regDate').valueAsDate = new Date();
        fetchData();
    }

    // --- Data Handling ---
    async function fetchData() {
        if(!GOOGLE_SCRIPT_URL || GOOGLE_SCRIPT_URL.includes("YOUR")) {
            participants = JSON.parse(localStorage.getItem('db_v8')) || [];
        } else {
            try {
                let res = await fetch(GOOGLE_SCRIPT_URL);
                participants = await res.json();
            } catch(e) { participants = JSON.parse(localStorage.getItem('db_v8')) || []; }
        }
    }

    async function pushData(action, payload) {
        // ‡ßß. ‡¶®‡¶§‡ßÅ‡¶® ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶®
        if(action === 'register') {
            participants.push(payload.data);
        }
        // ‡ß®. ‡¶∏‡ßç‡¶ï‡ßã‡¶∞ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
        else if(action === 'updateScore') {
            let p = participants.find(x => x.id == payload.id);
            if(p) { if(!p.scores) p.scores={}; p.scores[payload.gameCode] = payload.score; }
        }
        // ‡ß©. ‡¶®‡¶æ‡¶Æ ‡¶è‡¶°‡¶ø‡¶ü (NEW)
        else if(action === 'editName') {
            let p = participants.find(x => x.id == payload.id);
            if(p) { p.name = payload.newName; }
        }
        // ‡ß™. ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶™‡ßç‡¶≤‡ßá‡ßü‡¶æ‡¶∞ (NEW)
        else if(action === 'deletePlayer') {
            participants = participants.filter(x => x.id !== payload.id);
        }
        
        // LocalStorage ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
        localStorage.setItem('db_v8', JSON.stringify(participants));
        
        // Google Sheet ‡¶Ü‡¶™‡¶°‡ßá‡¶ü (‡¶Ø‡¶¶‡¶ø URL ‡¶•‡¶æ‡¶ï‡ßá)
        if(GOOGLE_SCRIPT_URL && !GOOGLE_SCRIPT_URL.includes("YOUR")) {
            // Google Script ‡¶è 'editName' ‡¶è‡¶¨‡¶Ç 'deletePlayer' ‡¶π‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡ßá‡¶≤ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ï‡ßã‡¶° ‡¶•‡¶æ‡¶ï‡¶§‡ßá ‡¶π‡¶¨‡ßá
            // ‡¶®‡¶§‡ßÅ‡¶¨‡¶æ ‡¶è‡¶ü‡¶ø ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú‡ßá‡¶á ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨‡ßá‡•§
            fetch(GOOGLE_SCRIPT_URL, { method:'POST', body:JSON.stringify({action, ...payload}) }).catch(e=>console.log(e));
        }
    }

    // --- Helper: Name Capitalization ---
    function formatName(name) {
        return name.toLowerCase().split(' ').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
    }

    // --- Registration ---
    async function register() {
        let name = document.getElementById('nameInput').value;
        const date = document.getElementById('regDate').value;
        const games = Array.from(document.querySelectorAll('.game-checkbox input:checked')).map(c=>c.value);
        
        if(!name || games.length === 0) return alert("‡¶®‡¶æ‡¶Æ ‡¶ì ‡¶ñ‡ßá‡¶≤‡¶æ ‡¶¶‡¶ø‡¶®");
        name = formatName(name);

        document.getElementById('regLoader').style.display = 'block';
        await pushData('register', { data: { id: Date.now(), name, date, games, scores: {} } });
        document.getElementById('regLoader').style.display = 'none';
        document.getElementById('nameInput').value = '';
        document.querySelectorAll('input[type=checkbox]').forEach(c=>c.checked=false);
        alert("‡¶®‡¶•‡¶ø‡¶≠‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡ßü‡ßá‡¶õ‡ßá");
    }

    // --- Transliteration ---
    document.getElementById('nameInput').addEventListener('input', function() {
        const val = this.value;
        if(val.length > 1) {
            fetch(`https://inputtools.google.com/request?text=${val}&itc=bn-t-i0-und&num=5`)
            .then(r=>r.json()).then(d=>{
                const s = document.getElementById('suggestions');
                if(d[1] && d[1][0] && d[1][0][1]) {
                    s.innerHTML = ''; s.style.display = 'block';
                    d[1][0][1].forEach(w=>{
                        let div = document.createElement('div'); div.style.padding='5px'; div.innerText=w;
                        div.onclick=()=>{ document.getElementById('nameInput').value=formatName(w); s.style.display='none'; };
                        s.appendChild(div);
                    });
                }
            });
        } else document.getElementById('suggestions').style.display='none';
    });

    // --- Management Logic ---
   function renderMgmt() {
    const game = document.getElementById('mgmtGameSelector').value;
    const search = document.getElementById('mgmtSearch').value.toLowerCase();
    const area = document.getElementById('mgmtArea');
    area.innerHTML = '';
    
    if(!game) return;

    // ‡ßß. ‡¶ñ‡ßá‡¶≤‡¶æ ‡¶¨‡¶®‡ßç‡¶ß ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡ßç‡¶ü ‡¶ì ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®
    if(gameConfig[game] && gameConfig[game].status === 'inactive') {
        alert("‡¶è‡¶á ‡¶ñ‡ßá‡¶≤‡¶æ‡¶ü‡¶ø‡¶∞ ‡¶™‡¶∞‡¶ø‡¶∏‡¶Æ‡¶æ‡¶™‡ßç‡¶§‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶è‡¶ñ‡¶® ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§");
        
        // ‡¶°‡ßç‡¶∞‡¶™‡¶°‡¶æ‡¶â‡¶® ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
        document.getElementById('mgmtGameSelector').value = ""; 
        
        // ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨‡ßá ‡¶™‡¶æ‡¶†‡¶ø‡ßü‡ßá ‡¶¶‡ßá‡¶ì‡ßü‡¶æ
        switchTab('results'); 
        
        // ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨‡ßá ‡¶ê ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü ‡¶ñ‡ßá‡¶≤‡¶æ‡¶ü‡¶ø ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßá ‡¶¶‡ßá‡¶ì‡ßü‡¶æ
        document.getElementById('resGameSelector').value = game; 
        renderResults();
        return;
    }

    // ‡ß®. ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶ñ‡ßá‡¶≤‡ßã‡ßü‡¶æ‡ßú ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ (‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ)
    let players = participants.filter(p => p.games.includes(game) && p.name.toLowerCase().includes(search));
    
    // ‡ß©. ‡¶ñ‡ßá‡¶≤‡¶æ‡¶∞ ‡¶ß‡¶∞‡¶® ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ
    if(game === 'musical_chair') {
        renderMusicalChairMgmt(players, area);
    } else if(game === 'sajo') {
        renderSajoMgmt(players, area);
    } else {
        renderStandardMgmt(players, area, game);
    }
}

    function renderStandardMgmt(players, container, game) {
        const conf = gameConfig[game];
        let table = `<table width="100%">`;
        
        players.forEach((p, i) => {
            const sc = (p.scores && p.scores[game]) ? p.scores[game] : '';
            let control = '';
            
            if(sc) {
                // Score exists: Show Score + Pencil + Replay
                control = `
                    <span style="font-weight:bold; color:green;">${sc}</span> 
                    <button class="btn-sm btn-edit" title="Edit Score" onclick="editScore(${p.id}, '${game}', '${sc}')">‚úèÔ∏è</button>
                    <button class="btn-sm btn-replay" title="Replay" onclick="resetScore(${p.id}, '${game}')">üîÑ</button>
                `;
            } else {
                // No score -> Timer or Input
                if(conf.type !== 'manual') {
                    control = `<button class="btn-sm" style="background:#2196f3; padding:8px 15px;" onclick="openTimer(${p.id}, '${p.name}', '${game}')">‚è±Ô∏è</button>`;
                } else {
                    control = `<input type="number" id="in_${p.id}" style="width:60px; padding:5px;" placeholder="${conf.unit}"> 
                               <button class="btn-sm" style="background:#4caf50" onclick="manualSave(${p.id}, '${game}')">üíæ</button>`;
                }
            }
            table += `<tr><td>${i+1}</td><td>${p.name}</td><td>${control}</td></tr>`;
        });
        container.innerHTML = table + `</table>`;
    }

    function renderMusicalChairMgmt(players, container) {
        const active = players.filter(p => !p.scores || !p.scores['musical_chair'] || p.scores['musical_chair'] === '');
        const outPlayers = players.filter(p => p.scores && p.scores['musical_chair']);
        
        const count = active.length;
        let table = `<div style="background:#e0f7fa; padding:10px; margin-bottom:10px;">‡¶¨‡¶æ‡¶ï‡¶ø ‡¶Ü‡¶õ‡ßá: <b>${count}</b> ‡¶ú‡¶®</div>`;
        table += `<table>`;

        active.forEach((p, i) => {
            let btns = '';
            if(count > 3) {
                btns = `<button class="btn-sm btn-out" onclick="setRank(${p.id}, 'musical_chair', 'out')">‡¶¨‡¶æ‡¶¶ (Out)</button>`;
            } else if (count === 3) {
                btns = `<button class="btn-sm btn-3rd" onclick="setRank(${p.id}, 'musical_chair', '3rd')">‡ß©‡ßü (3rd)</button>
                        <button class="btn-sm btn-out" onclick="setRank(${p.id}, 'musical_chair', 'out')">‡¶¨‡¶æ‡¶¶</button>`;
            } else if (count === 2) {
                btns = `<button class="btn-sm btn-1st" onclick="setRank(${p.id}, 'musical_chair', '1st')">‡ßß‡¶Æ</button>
                        <button class="btn-sm btn-2nd" onclick="setRank(${p.id}, 'musical_chair', '2nd')">‡ß®‡ßü</button>`;
            }
            table += `<tr><td>${i+1}</td><td>${p.name}</td><td>${btns}</td></tr>`;
        });
        
        outPlayers.forEach(p => {
             const rank = p.scores['musical_chair'];
             table += `<tr style="background:#ffebee; color:#888;"><td>-</td><td>${p.name} (${rank})</td><td><button class="btn-sm btn-undo" onclick="setRank(${p.id}, 'musical_chair', '')">‡¶´‡ßá‡¶∞‡¶§ ‡¶Ü‡¶®‡ßÅ‡¶®</button></td></tr>`;
        });

        container.innerHTML = table + `</table>`;
    }

    function renderSajoMgmt(players, container) {
        let table = `<table><tr><th>‡¶®‡¶æ‡¶Æ</th><th>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ ‡¶ì ‡¶´‡¶≤‡¶æ‡¶´‡¶≤</th></tr>`;
        players.forEach(p => {
            const sc = (p.scores && p.scores['sajo']) ? p.scores['sajo'] : '';
            let content = '';
            
            if(sc) {
                const parts = sc.split('#');
                content = `<b>${parts[0]}</b> - ${parts[1]} (${parts[2]}) <button class="btn-sm" style="background:#607d8b" onclick="setRank(${p.id}, 'sajo', '')">Reset</button>`;
            } else {
                content = `
                    <input type="text" id="sajo_c_${p.id}" placeholder="‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü" style="width:120px; margin-bottom:5px;">
                    <input type="number" id="sajo_m_${p.id}" placeholder="‡¶®‡¶Æ‡ßç‡¶¨‡¶∞" style="width:60px;">
                    <br>
                    <button class="btn-sm btn-1st" onclick="saveSajo(${p.id}, '1st')">‡ßß‡¶Æ</button>
                    <button class="btn-sm btn-2nd" onclick="saveSajo(${p.id}, '2nd')">‡ß®‡ßü</button>
                    <button class="btn-sm btn-3rd" onclick="saveSajo(${p.id}, '3rd')">‡ß©‡ßü</button>
                `;
            }
            table += `<tr><td>${p.name}</td><td>${content}</td></tr>`;
        });
        container.innerHTML = table + `</table>`;
    }

    // --- Actions ---
    async function manualSave(id, game) {
        const val = document.getElementById(`in_${id}`).value;
        if(val) {
            await pushData('updateScore', { id, gameCode: game, score: val });
            renderMgmt();
        }
    }

    async function setRank(id, game, rank) {
        await pushData('updateScore', { id, gameCode: game, score: rank });
        renderMgmt();
    }

    async function saveSajo(id, rank) {
        const c = document.getElementById(`sajo_c_${id}`).value;
        const m = document.getElementById(`sajo_m_${id}`).value;
        if(!c || !m) return alert('‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü ‡¶ì ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡¶®');
        const val = `${rank}#${c}#${m}`;
        await pushData('updateScore', { id, gameCode: 'sajo', score: val });
        renderMgmt();
    }

    async function editScore(id, game, oldVal) {
        const newVal = prompt("‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡ßç‡¶ï‡ßã‡¶∞ ‡¶¶‡¶ø‡¶®:", oldVal);
        if(newVal && newVal !== null && newVal !== oldVal) {
            await pushData('updateScore', { id, gameCode: game, score: newVal });
            renderMgmt();
        }
    }

    async function resetScore(id, game) {
        if(confirm("‡¶∏‡ßç‡¶ï‡ßã‡¶∞ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ñ‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")) {
            await pushData('updateScore', { id, gameCode: game, score: "" }); 
            renderMgmt();
        }
    }

    // --- Updated Timer Logic ---
    let timerInt, startTime, running = false, timerData = null;
    let elapsedTime = 0; // Tracks elapsed time for resume

    function formatTime(ms) {
        if(isNaN(ms) || ms < 0) return "00:00:00.00";
        let m = Math.floor((ms/(1000*60))%60), s = Math.floor((ms/1000)%60), mil = Math.floor((ms%1000)/10);
        return `00:${m<10?'0'+m:m}:${s<10?'0'+s:s}:${mil<10?'0'+mil:mil}`;
    }

    function openTimer(id, name, game) {
        const conf = gameConfig[game];
        const duration = parseInt(conf.duration) || 60; 
        timerData = { id, game, type: conf.type, limit: duration * 1000 };
        
        document.getElementById('timerModal').style.display = 'flex';
        document.getElementById('timerPlayerName').innerText = name;
        document.getElementById('timerGameLabel').innerText = conf.label;
        document.getElementById('waterInputDiv').style.display = (game === 'glass_circle') ? 'block' : 'none';
        
        if(conf.type === 'fixed') {
             document.getElementById('scoreInputLabel').innerText = "‡¶ï‡ßü‡¶ü‡¶ø ‡¶ñ‡ßá‡¶≤‡ßã?";
        } else {
             document.getElementById('scoreInputLabel').innerText = "‡¶´‡¶≤‡¶æ‡¶´‡¶≤";
        }

        // Reset inputs
        document.getElementById('finalScoreInput').value = '';
        document.getElementById('waterAmount').value = '';

        resetTimer();
    }

    function resetTimer() {
        clearInterval(timerInt); 
        running = false;
        elapsedTime = 0;
        
        document.getElementById('timerDisplay').innerText = (timerData.type === 'fixed') ? formatTime(timerData.limit) : "00:00:00.00";
        
        // Show Start Button, Hide Pause/Resume
        document.getElementById('mainControls').style.display = 'flex';
        document.getElementById('pausedControls').style.display = 'none';
        document.getElementById('btnStart').style.display = 'inline-block';
        document.getElementById('btnPause').style.display = 'none';
    }

    function startTimer() {
        if(running) return;
        running = true;
        
        document.getElementById('btnStart').style.display = 'none';
        document.getElementById('btnPause').style.display = 'inline-block';
        document.getElementById('mainControls').style.display = 'flex';
        document.getElementById('pausedControls').style.display = 'none';

        const start = Date.now();
        const initial = (timerData.type === 'fixed') ? (timerData.limit - elapsedTime) : elapsedTime;
        
        timerInt = setInterval(() => {
            const now = Date.now();
            const delta = now - start;
            
            let current;
            if(timerData.type === 'fixed') {
                current = initial - delta;
                elapsedTime = timerData.limit - current; // Update elapsed for resume
            } else {
                current = initial + delta;
                elapsedTime = current;
            }
            
            // Auto stop for Fixed Timer
            if(current <= 0 && timerData.type === 'fixed') { 
                current = 0; 
                pauseTimer(); // Show controls when time is up
                if(navigator.vibrate) navigator.vibrate(500);
            } 
            
            document.getElementById('timerDisplay').innerText = formatTime(current);
        }, 30);
    }

    function pauseTimer() {
        clearInterval(timerInt); 
        running = false;
        
        // Hide Main Controls, Show Paused Controls
        document.getElementById('mainControls').style.display = 'none';
        document.getElementById('pausedControls').style.display = 'block';

        // Pre-fill time for non-fixed games (like Shankha)
        if(timerData.game !== 'glass_circle' && timerData.type !== 'fixed') {
            document.getElementById('finalScoreInput').value = document.getElementById('timerDisplay').innerText;
        }
        
        // Focus for Phuchka (Fixed)
        if(timerData.type === 'fixed') {
            document.getElementById('finalScoreInput').focus();
        }
    }

    function resumeTimer() {
        // Just call start, it handles using 'elapsedTime'
        startTimer();
    }

    async function saveTimerData() {
        let val = '';
        if(timerData.game === 'glass_circle') {
            const time = document.getElementById('timerDisplay').innerText;
            const water = document.getElementById('waterAmount').value || 0;
            val = `${time} | ${water}ml`;
        } else {
            val = document.getElementById('finalScoreInput').value;
        }
        if(!val) return alert("‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®");
        
        await pushData('updateScore', { id: timerData.id, gameCode: timerData.game, score: val });
        closeTimer();
        renderMgmt();
    }
    
    function closeTimer() {
        clearInterval(timerInt);
        document.getElementById('timerModal').style.display = 'none';
    }

    // --- Results Logic ---
    function renderResults() {
        const game = document.getElementById('resGameSelector').value;
        const tbody = document.getElementById('resBody');
        tbody.innerHTML = '';
        if(!game) return;

        const conf = gameConfig[game];
        document.getElementById('resTitle').innerText = conf.label + " - ‡¶ö‡ßÇ‡ßú‡¶æ‡¶®‡ßç‡¶§ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ";

        let list = participants.filter(p => p.scores && p.scores[game]);

        list.sort((a, b) => {
            let sa = a.scores[game], sb = b.scores[game];

            if(game === 'musical_chair' || game === 'sajo') {
                const rankMap = { '1st':1, '2nd':2, '3rd':3 };
                const ra = (sa.includes('#') ? sa.split('#')[0] : sa).toLowerCase();
                const rb = (sb.includes('#') ? sb.split('#')[0] : sb).toLowerCase();
                const va = rankMap[ra] || 99;
                const vb = rankMap[rb] || 99;
                return va - vb;
            }
            if(game === 'glass_circle') {
                let ta = sa.split('|')[0].trim();
                let tb = sb.split('|')[0].trim();
                return ta.localeCompare(tb);
            }
            if(game === 'shankha') {
                return sb.localeCompare(sa);
            }
            let na = parseFloat(sa), nb = parseFloat(sb);
            if(isNaN(na)) return 1; if(isNaN(nb)) return -1;
            return (conf.sort === 'low') ? na - nb : nb - na;
        });

        list.forEach((p, i) => {
            let rankDisplay = (i+1) + "‡•§";
            let displayScore = p.scores[game];

            if(game === 'hari_bhanga') displayScore += " ‡¶∏‡ßá‡¶Æ‡¶ø";
            if(game === 'candle' || game === 'phuchka') displayScore += " ‡¶ü‡¶ø";
            if(game === 'glass_circle') {
                const parts = displayScore.split('|');
                displayScore = `‡¶∏‡¶Æ‡ßü ${parts[0]} (‡¶ú‡¶≤: ${parts[1]})`;
            }
            if(game === 'sajo') {
                const parts = displayScore.split('#');
                if(parts.length > 1) {
                    displayScore = `${parts[1]} (${parts[2]} ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞)`;
                    if(parts[0] === '1st') rankDisplay = '‡ßß‡•§';
                    if(parts[0] === '2nd') rankDisplay = '‡ß®‡•§';
                    if(parts[0] === '3rd') rankDisplay = '‡ß©‡•§';
                }
            }
            if(game === 'musical_chair') {
                if(displayScore === '1st') rankDisplay = '‡ßß‡•§';
                else if(displayScore === '2nd') rankDisplay = '‡ß®‡•§';
                else if(displayScore === '3rd') rankDisplay = '‡ß©‡•§';
                else rankDisplay = '';
            }

            let rowStyle = "";
            if(i === 0) rowStyle = "background:#fff9c4; font-weight:bold;";
            if(i === 1) rowStyle = "background:#f5f5f5; font-weight:bold;";
            if(i === 2) rowStyle = "background:#ffe0b2; font-weight:bold;";

            if(rankDisplay) {
                tbody.innerHTML += `<tr style="${rowStyle}"><td>${rankDisplay}</td><td>${p.name}</td><td>${displayScore}</td></tr>`;
            }
        });
    }

    // --- Settings UI ---
  function renderSettingsUI() {
    const div = document.getElementById('settingsList');
    div.innerHTML = '';
    
    for(let k in gameConfig) {
        const g = gameConfig[k];
        
        // ‡¶ñ‡ßá‡¶≤‡¶æ ‡¶¨‡¶®‡ßç‡¶ß ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶≤‡¶æ‡¶≤‡¶ö‡ßá ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
        const rowBg = g.status === 'inactive' ? '#ffebee' : 'transparent';
        const statusText = g.status === 'active' ? '‚óè ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶Ü‡¶õ‡ßá' : '‚óè ‡¶¨‡¶®‡ßç‡¶ß';
        const statusColor = g.status === 'active' ? '#2e7d32' : '#c62828';

        // ‡¶®‡¶ø‡¶∞‡ßç‡¶ß‡¶æ‡¶∞‡¶ø‡¶§ ‡¶∏‡¶Æ‡ßü‡ßá‡¶∞ ‡¶ñ‡ßá‡¶≤‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶á‡¶®‡¶™‡ßÅ‡¶ü
        const durationInput = (g.type === 'fixed') 
            ? `<input type="number" value="${g.duration || 60}" style="width:50px; margin-right:5px; padding:3px; border:1px solid #ccc; border-radius:4px;" onchange="updateConfig('${k}', 'duration', this.value)" title="‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°">` 
            : '';

        div.innerHTML += `
            <div style="padding:15px; border-bottom:1px solid #ddd; display:flex; justify-content:space-between; align-items:center; background: ${rowBg}; transition: 0.3s;">
                <div>
                    <div style="font-weight:bold; font-size:16px;">${g.label}</div>
                    <div style="font-size:12px; color:${statusColor}; font-weight:600;">${statusText}</div>
                </div>
                
                <div style="display:flex; align-items:center; gap:8px;">
                    ${durationInput}
                    
                    <select onchange="updateConfig('${k}', 'type', this.value)" style="padding:5px; font-size:13px; border-radius:4px;">
                        <option value="manual" ${g.type=='manual'?'selected':''}>‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßÅ‡ßü‡¶æ‡¶≤</option>
                        <option value="fixed" ${g.type=='fixed'?'selected':''}>‡¶∏‡¶Æ‡ßü (Fixed)</option>
                        <option value="open" ${g.type=='open'?'selected':''}>‡¶∏‡ßç‡¶ü‡¶™‡¶ì‡ßü‡¶æ‡¶ö</option>
                    </select>

                    <select onchange="updateConfig('${k}', 'status', this.value)" style="padding:5px; font-size:13px; border-radius:4px; font-weight:bold; border: 1px solid ${statusColor};">
                        <option value="active" ${g.status=='active'?'selected':''}>Active</option>
                        <option value="inactive" ${g.status=='inactive'?'selected':''}>Inactive</option>
                    </select>
                </div>
            </div>
        `;
    }
}

// ‡¶ï‡¶®‡¶´‡¶ø‡¶ó ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶π‡¶æ‡ßü‡¶ï ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
function updateConfig(game, key, val) {
    if(key === 'duration') val = parseInt(val);
    gameConfig[game][key] = val;
    localStorage.setItem('gameConfig_v11', JSON.stringify(gameConfig));
    renderSettingsUI(); // ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶æ‡¶•‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
}
    
    function updateConfig(game, key, val) {
        if(key === 'duration') val = parseInt(val);
        gameConfig[game][key] = val;
        localStorage.setItem('gameConfig_v10', JSON.stringify(gameConfig));
        if(key === 'type') renderSettingsUI(); 
    }

    function saveConfig() {
        localStorage.setItem('gameConfig_v10', JSON.stringify(gameConfig));
        alert('‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç ‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
    }

    if(sessionStorage.getItem('role')) checkLogin(); 
    // --- Player Management Logic (Settings) ---
// --- ‡ß©. ‡¶™‡ßç‡¶≤‡ßá‡ßü‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ (‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶≠‡¶æ‡¶∞‡ßç‡¶∏‡¶®) ---
function renderPlayerList() {
    const search = document.getElementById('settingSearch').value.toLowerCase();
    const container = document.getElementById('playerMgmtList');
    container.innerHTML = '';

    const list = participants.filter(p => p.name.toLowerCase().includes(search));

    if(list.length === 0) {
        container.innerHTML = '<p style="text-align:center; color:gray;">‡¶ï‡ßã‡¶®‡ßã ‡¶®‡¶æ‡¶Æ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø</p>';
        return;
    }

    const displayList = search ? list : list.slice().reverse().slice(0, 10); 

    displayList.forEach(p => {
        const div = document.createElement('div');
        div.className = 'player-row';
        
        // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá onclick ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá
        div.innerHTML = `
            <span class="player-name" onclick="showPlayerGames(${p.id})" title="‡¶Ö‡¶Ç‡¶∂‡¶ó‡ßç‡¶∞‡¶π‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶ñ‡ßá‡¶≤‡¶æ ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®">
                ${p.name} <small style="color:gray; font-size:10px;">(ID: ${p.id})</small>
            </span>
            <div>
                <button class="btn-sm btn-edit-name" onclick="editParticipantName(${p.id}, '${p.name}')">‚úèÔ∏è</button>
                <button class="btn-sm btn-del" onclick="deleteParticipant(${p.id})">üóëÔ∏è</button>
            </div>
        `;
        container.appendChild(div);
    });
}

// --- ‡ß™. ‡¶™‡¶™-‡¶Ü‡¶™ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ---
function showPlayerGames(id) {
    const p = participants.find(x => x.id == id);
    if(!p) return;

    // ‡¶ñ‡ßá‡¶≤‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ‡¶ó‡ßÅ‡¶≤‡ßã ‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶∏‡¶æ‡¶ú‡¶æ‡¶®‡ßã
    const gameNames = p.games.map(g => {
        return gameConfig[g] ? `‚úÖ ${gameConfig[g].label}` : g;
    }).join('\n');

    alert(`‡¶ñ‡ßá‡¶≤‡ßã‡ßü‡¶æ‡ßú: ${p.name}\n\n‡¶Ö‡¶Ç‡¶∂‡¶ó‡ßç‡¶∞‡¶π‡¶£‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶ñ‡ßá‡¶≤‡¶æ‡¶∏‡¶Æ‡ßÇ‡¶π:\n----------------------\n${gameNames}`);
}

 let currentEditId = null; // ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßü ‡¶Ü‡¶á‡¶°‡¶ø ‡¶Æ‡¶®‡ßá ‡¶∞‡¶æ‡¶ñ‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø

    // ‡ßß. ‡¶è‡¶°‡¶ø‡¶ü ‡¶¨‡¶æ‡¶ü‡¶® ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶è‡¶á ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ü‡¶ø ‡¶ï‡¶≤ ‡¶π‡¶¨‡ßá
    function editParticipantName(id) {
        const p = participants.find(x => x.id == id);
        if(!p) return;

        currentEditId = id;
        document.getElementById('editNameInput').value = p.name;
        
        // ‡¶ö‡ßá‡¶ï‡¶¨‡¶ï‡ßç‡¶∏‡¶ó‡ßÅ‡¶≤‡ßã ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ
        const container = document.getElementById('editGamesContainer');
        container.innerHTML = '';
        
        // ‡¶ó‡ßá‡¶Æ ‡¶ï‡¶®‡¶´‡¶ø‡¶ó ‡¶•‡ßá‡¶ï‡ßá ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶®‡ßá‡¶ì‡ßü‡¶æ
        for(let key in gameConfig) {
            const isChecked = p.games.includes(key) ? 'checked' : '';
            // ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ Active ‡¶ó‡ßá‡¶Æ‡¶ó‡ßÅ‡¶≤‡ßã ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶¨‡ßá ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶Ø‡¶¶‡¶ø ‡¶™‡ßç‡¶≤‡ßá‡ßü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Ü‡¶ó‡ßá ‡¶•‡ßá‡¶ï‡ßá‡¶á ‡¶∏‡ßá‡¶á ‡¶ó‡ßá‡¶Æ ‡¶®‡ßá‡¶ì‡ßü‡¶æ ‡¶•‡¶æ‡¶ï‡ßá
            if(gameConfig[key].status === 'active' || isChecked) {
                container.innerHTML += `
                    <label class="game-checkbox">
                        <input type="checkbox" value="${key}" ${isChecked}> ${gameConfig[key].label}
                    </label>
                `;
            }
        }
        
        // ‡¶Æ‡¶°‡¶æ‡¶≤ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
        document.getElementById('editModal').style.display = 'flex';
    }

    // ‡ß®. ‡¶Æ‡¶°‡¶æ‡¶≤‡ßá‡¶∞ '‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®' ‡¶¨‡¶æ‡¶ü‡¶® ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶è‡¶á ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶ï‡¶≤ ‡¶π‡¶¨‡ßá
    async function saveEditData() {
        if(!currentEditId) return;

        const newName = document.getElementById('editNameInput').value;
        // ‡¶è‡¶°‡¶ø‡¶ü ‡¶Æ‡¶°‡¶æ‡¶≤ ‡¶•‡ßá‡¶ï‡ßá ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶ó‡ßá‡¶Æ‡¶ó‡ßÅ‡¶≤‡ßã ‡¶®‡ßá‡¶ì‡ßü‡¶æ
        const newGames = Array.from(document.querySelectorAll('#editGamesContainer input:checked')).map(c => c.value);

        if(!newName || newGames.length === 0) return alert("‡¶®‡¶æ‡¶Æ ‡¶è‡¶¨‡¶Ç ‡¶Ö‡¶®‡ßç‡¶§‡¶§ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶ñ‡ßá‡¶≤‡¶æ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®");

        // ‡¶≤‡ßã‡¶°‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¨‡¶æ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶¶‡ßá‡¶ñ‡¶æ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶® ‡¶è‡¶ñ‡¶æ‡¶®‡ßá
        document.getElementById('editModal').style.display = 'none';
        
        // ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã (Action: editPlayer)
        await pushData('editPlayer', { 
            id: currentEditId, 
            newName: formatName(newName), 
            newGames: newGames 
        });

        // ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶Ü‡¶™‡¶°‡ßá‡¶ü (‡¶§‡¶æ‡ßé‡¶ï‡ßç‡¶∑‡¶£‡¶ø‡¶ï ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)
        let p = participants.find(x => x.id == currentEditId);
        if(p) {
            p.name = formatName(newName);
            p.games = newGames;
        }
        
        renderPlayerList(); // ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂
        alert("‡¶∏‡¶Ç‡¶∂‡ßã‡¶ß‡¶® ‡¶∏‡¶´‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
    }

    async function deleteParticipant(id) {
        if (confirm("‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶è‡¶á ‡¶ñ‡ßá‡¶≤‡ßã‡ßü‡¶æ‡ßú‡¶ï‡ßá ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶è‡¶ü‡¶ø ‡¶´‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ü‡¶®‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§")) {
            await pushData('deletePlayer', { id: id });
            renderPlayerList(); // Refresh list
            alert("‡¶ñ‡ßá‡¶≤‡ßã‡ßü‡¶æ‡ßú ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
        }
    }
    
    // ******************************************************
    // ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ (‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)
    // ******************************************************
    
    let lastKnownTime = Date.now(); 
    let isFirstCheck = true;

    // ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡ßÆ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶™‡¶∞ ‡¶™‡¶∞ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶¨‡ßá
    setInterval(checkForNewScores, 8000);

    async function checkForNewScores() {
        // ‡¶∂‡¶∞‡ßç‡¶§: ‡¶Ø‡¶¶‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ 'results' ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá‡¶®, ‡¶§‡¶¨‡ßá ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞‡ßá ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶¨‡ßá ‡¶®‡¶æ
        const resultsTab = document.getElementById('results');
        if (!resultsTab || !resultsTab.classList.contains('active')) {
            return; // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá‡¶á ‡¶•‡¶æ‡¶Æ‡¶¨‡ßá
        }

        // ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü URL ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨‡ßá ‡¶®‡¶æ
        if(!GOOGLE_SCRIPT_URL || GOOGLE_SCRIPT_URL.includes("YOUR")) return;

        try {
            const res = await fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify({ action: 'checkUpdates' })
            });
            const data = await res.json();

            // ‡¶Ø‡¶¶‡¶ø ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßü > ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶∂‡ßá‡¶∑ ‡¶ú‡¶æ‡¶®‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßü ‡¶π‡ßü
            if (data.time && data.time > lastKnownTime) {
                lastKnownTime = data.time;
                
                // ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡¶¨‡¶æ‡¶∞ ‡¶≤‡ßã‡¶° ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßü ‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶¨‡¶æ‡¶ú‡¶¨‡ßá ‡¶®‡¶æ, ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶®‡¶§‡ßÅ‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡ßá ‡¶¨‡¶æ‡¶ú‡¶¨‡ßá
                if (!isFirstCheck) {
                    playNotification(data.msg);
                    renderResults(); // ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶π‡¶¨‡ßá
                }
            }
            isFirstCheck = false;
        } catch (e) {
            console.log("Update check failed", e);
        }
    }

    function playNotification(msg) {
        // ‡ßß. ‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶¨‡¶æ‡¶ú‡¶æ‡¶®‡ßã
        const audio = document.getElementById('notifSound');
        if(audio) {
            audio.currentTime = 0;
            // ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ ‡¶™‡¶≤‡¶ø‡¶∏‡¶ø‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£‡ßá ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶® ‡¶õ‡¶æ‡ßú‡¶æ ‡¶Ö‡¶°‡¶ø‡¶ì ‡¶¨‡¶æ‡¶ú‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá
            audio.play().catch(e => console.log("Audio play blocked until interaction"));
        }

        // ‡ß®. ‡¶ü‡ßã‡¶∏‡ßç‡¶ü ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
        showToast(msg);
    }

    // ‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞ ‡¶™‡¶™-‡¶Ü‡¶™ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    function showToast(message) {
        let toast = document.createElement("div");
        toast.innerText = message;
        // ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤‡¶ø‡¶Ç
        Object.assign(toast.style, {
            position: "fixed", bottom: "20px", right: "20px",
            background: "#333", color: "#fff", padding: "15px",
            borderRadius: "5px", zIndex: "10000",
            boxShadow: "0 2px 10px rgba(0,0,0,0.3)",
            fontSize: "14px", fontFamily: "sans-serif"
        });
        
        document.body.appendChild(toast);

        // ‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶™‡¶∞ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá
        setTimeout(() => { 
            toast.style.opacity = "0";
            setTimeout(() => toast.remove(), 500);
        }, 5000);
    }
    // --- ‡ßß. ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (‡¶ö‡¶≤‡¶Æ‡¶æ‡¶® ‡¶ï‡¶æ‡¶ú ‡¶¨‡¶®‡ßç‡¶ß ‡¶®‡¶æ ‡¶ï‡¶∞‡ßá) ---
async function manualRefresh(btnElement) {
    const originalText = btnElement.innerText;
    btnElement.innerText = "‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
    btnElement.disabled = true;

    try {
        // ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Ü‡¶®‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
        await fetchData(); 
        
        // ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü‡¶ó‡ßÅ‡¶≤‡ßã ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá (Timer ‡¶¨‡¶æ Modal ‡¶¨‡¶®‡ßç‡¶ß ‡¶π‡¶¨‡ßá ‡¶®‡¶æ)
        // ‡¶Ø‡ßá ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ ‡¶ñ‡ßã‡¶≤‡¶æ ‡¶Ü‡¶õ‡ßá ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶∏‡ßá‡¶ü‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶¨‡ßá
        if(document.getElementById('management').classList.contains('active')) renderMgmt();
        if(document.getElementById('results').classList.contains('active')) renderResults();
        if(document.getElementById('settings').classList.contains('active')) renderPlayerList();

        alert("‡¶°‡¶æ‡¶ü‡¶æ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
    } catch (error) {
        alert("‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®!");
        console.error(error);
    } finally {
        btnElement.innerText = originalText;
        btnElement.disabled = false;
    }
}

// --- ‡ß®. ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ---
function doLogout() {
    if(confirm("‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")) {
        sessionStorage.clear(); // ‡¶∏‡ßá‡¶∂‡¶® ‡¶ï‡ßç‡¶≤‡¶ø‡ßü‡¶æ‡¶∞
        location.reload(); // ‡¶™‡ßá‡¶ú ‡¶∞‡¶ø‡¶≤‡ßã‡¶° ‡¶π‡ßü‡ßá ‡¶≤‡¶ó‡¶ø‡¶® ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá
    }
}
</script>

</body>
</html>